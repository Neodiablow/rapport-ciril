\section{Présentation de Logstash}

\subsection{Pourquoi Logstash?}
Logstash parce que, bien qu'un adminsys compétent soit capable d'analyser
de façon rapide et efficace les logs d'une machine (perl+awk+sed+tail+grep)
Face à des dizaines/milliers de hosts cette méthode ne fonctionne souffre pas
le passage à l'échelle.
De plus il est fréquent, actuellement (cloud, application multicouche) que
que les logs d'une machine ne suffise plus à diagnostiquer un problème.

\section{Installation}
%Sur debian il n'existe pas de paquet deb déjà fait, et le seul prérequis 
%est d'avoir une version de java > 1.7.0\_45
%Pour télécharger et installer
%curl -O https://download.elasticsearch.org/logstash/logstash/logstash-1.4.2.tar.gz
%
%tar zxvf logstash-1.4.2.tar.gz
%
%script before-install.sh
%
%sudo cp -r /home/\$USER/Downloads/logstash-1.4.2 /opt/logstash
%
%sudo mkdir /var/log/logstash
%
%script after-install.sh
%
%cd logstash-1.4.2
%
%
%Création du path
%
%export PATH+=:/opt/logstash
%
%
%
%Dautres méthodes d'installation

%Ensuite un simple git clone https://github.com/elastic/logstash.git
%nous permet de récupérer le dépot stable le plus récent.
%Enfin des scripts d'installation sont disponible
%dans logstash/pkg/debian



Sur Debian jessie il n'existe pas de paquet officiel logstash maintenu. Il existe 
en revanche un paquet tierce\footnote{https://download.elastic.co/logstash/logstash/packages/debian/logstash\_1.4.2-1-2c0f5a1\_all.deb} 
chez l'éditeur du logiciel. Le dit paquet n'est pas de très bonne facture  puisqu'il 
nécessite l'ajout de dépendances manuelles ainsi qu'un rechargement de la configuration 
des services : \emph{systemctl daemon-reload}.



Les dépendances nécessaires sont \emph{jruby} et \emph{openjdk-7-jre} les mêmes 
que pour elasticsearch.

Une autre manière de réaliser l'installation est d'ajouter les dépots logstash à 
/etc/apt/source.list.d/logstash.list.d/logstash.list

deb https://packages.elasticsearch.org/logstash/1.4/debian stable main

et évidemment la clef qui va bien\footnote{blablabla une clé ça sert à balball}

wget -qO - https://packages.elasticsearch.org/GPG-KEY-elasticsearch | sudo apt-key add -



\section{Utilisation basique}

\subsection{Vocabulaire}
L'utilisation de logstash s'articule autour de 3 \emph{blocs}.
\begin{itemize}
    \item   Le bloc : \emph{Inputs} gère l'entrée des évènements dans logstash
    \item   Le bloc : \emph{Filters} s'occupe de la manipulation, modification, mutation, ...
    des évènements dans logstash
    \item   Le bloc : \emph{Outputs} gère la sortie des évènements de logstash
\end{itemize}

Cette façon de fonctionner ressemble un peu à celle utilisée par les tables de 
\emph{iptables}.

On considèrera chaque \emph{log} qui arrive à logstash comme un évènement (event).

Chaque bloc est composé d'une multitude de plugins. Ce sont des modules indépendants
qui peuvent également fonctionner en conjonction les uns des autres.

Il est possible de configure le bloc \emph{inputs} pour utiliser plusieurs fois 
le plugin file (pour des cas d'utilisation différents par exemple) et de se servir 
dans le même temps du plugin stdin qui prendra typiquement en entrée le clavier.


Il est possible de créer un nouveau module qui conviendra à un cas d'utilisation 
particulier, pour cela il faut utiliser le langage ruby.


Il existe également un pseudo-bloc qui peut s'insérer dans les autres, ce bloc, \emph{codec} 
permet la de gérer la \textit{représentation des données} c'est à dire qu'un codec
est capable de lire ou d'écrire dans une syntaxe particulière comme par exemple 
rubydebug, collectd ou bien plus intéressant pour nous netflow.
\section{Mon serveur central}



\section{Monter à l'échelle}

\documentclass[a4paper,12pt,one side,titlepage]{report}

%en francais
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[francais]{babel}
%fonts
\usepackage{lmodern}
\usepackage[scaled]{helvet}
\usepackage{fourier}
\usepackage{inconsolata}


\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{eurosym}
\usepackage{float}
%\usepackage[bottom=2.5cm,left=2.5cm,right=2.5cm]{geometry}
\usepackage[bottom=2.8cm]{geometry}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage[acronym]{glossaries}
\usepackage[hidelinks]{hyperref}
\usepackage{lipsum}
\usepackage{lastpage}
\usepackage{listings}
\usepackage{pdfpages}
%\usepackage{titlesec}
\usepackage{url}
\usepackage{wrapfig}

\graphicspath{ {../images/} } % dossier img

%lstdefines etc....
\input{codeconf.tex}

\renewcommand{\familydefault}{phv}
%\renewcommand{\familydefault}{\ttdefault}

\newcommand{\selv}{%
\fontfamily{phv}\fontseries{b}\fontsize{8}{20}\selectfont}
\newcommand{\belv}{%
\fontfamily{phv}\fontseries{b}\fontsize{10}{22}\selectfont}
\newcommand{\telv}{%
\fontfamily{phv}\fontseries{l}\fontsize{12}{22}\selectfont}
\newcommand{\inco}{%
\fontfamily{\ttdefault}\fontseries{b}\fontsize{10}{10}\selectfont}
\newcommand{\ipath}[1]{{\inco \normalsize {#1}}}
%\newcommand{\fnu}[1]{\footnote{\url{#1}}}
\newcommand{\fnu}[2][]{\footnote{{#1}\url{#2}}}


%%% header & footer
% \leftmark : afficher nom section
\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{1pt}
\fancyhead[C]{\selv\leftmark}
\fancyhead[L]{\selv ELK}
\fancyhead[R]{\selv Équipe réseau Lothaire}%\includegraphics[width=60px]{openstack-logo.png}}

\renewcommand{\footrulewidth}{0pt}
\fancyfoot[C]{\telv Page \thepage\hspace{2px} / \pageref{LastPage}} 
\fancyfoot[L]{\includegraphics[height=20px]{elasticmini.png}}
\fancyfoot[R]{\belv François \textsc{Dupont}}



%Titre et Auteurs
%\title{Architecture pour l'hébergement web à fort trafic}
%\author{Auteurs : \textit{Dupont Francois}\\\\Tuteur : \textit{Vincent Delove}}
%\date{Lundi 23 Mars 2015}


\input{./glossaire.tex}

\makeglossaries

\begin{document}

\input{./title.tex}



%Page remerciments
\emph{\Large Remerciements}
\\[2cm]
Je tiens tout d'abord à remercier Vincent \textsc{Delove} mon maître de stage pour 
m'avoir proposé le sujet, mais également pour son support, ses conseils, sa patience
et sa disponibilité.
\\[2cm]
Je remercie également Emanuel \textsc{Nataf} mon tuteur pour  son intérêt pour mon 
sujet ainsi que les marges de manoeuvres qu'il à su me laisser.
\\[1cm]
Merci à toute l'équipe du réseau Lothaire pour son accueil chaleureux et son soutien.
Je remercie plus particulièrement  Luc \textsc{Didry} et Stéphane \textsc{Fetter} pour leur
aide, en général, et  notamment en système.

%Page table des matières
\setcounter{tocdepth}{1}
\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Introduction
\part{Introduction}

\chapter{Introduction}
\section{Problématique}
La gestion de \gls{logs} est une problématique commune à presque tous les services informatiques,
tous les fournisseurs de services et plus globalement, toutes personnes gérant une infrastructure 
informatisée.

Les \gls{logs} sont précieux car ils sont un des éléments indispensables au dépannage, 
au monitoring. Ils permettent d'anticiper des problèmes inhérents à l'exploitation 
des infrastructures, et  de constater de potentielles tentatives d'intrusions.
À ces aspects pratiques relatifs au bon fonctionnement des systèmes s'ajoute également
une problématique judiciaire. Il est souvent nécessaire de garder des logs pour un 
temps défini  dans la loi. Ces logs doivent évidemment être consultables de manière
diligente.

Avec des milliers de lignes de logs par seconde, il est devenu impossible de naviguer
"au hasard" dans les fichiers pour regarder si tout se passe bien.

Cependant, \emph{de nombreuses structures continuent encore aujourd'hui d'analyser 
plus ou moins "manuellement" leurs \emph{\gls{logs}}}. Cette méthode reste envisageable 
si on cherche quelque chose de précis, comme une IP dans un intervalle de quelques 
secondes, mais impossible pour des recherches trop vagues, on se noie.


\section{Objectif}
En résumé, l'objectif de ce projet est de redonner la possibilité aux administrateurs
de vérifier le bon fonctionnement de leur infrastructure sans avoir à attendre l'alerte
Nagios (qui reste indispensable). L'idée est de permettre un suivi quotidien, permettant
de mettre en évidence des indicateurs de bonne ou de mauvaise santé du système, sans 
pour autant que ces problèmes soient critiques (mieux le système est entretenu, moins
on risque la panne).
Pour réaliser ce projet il a été décidé d'utiliser la stack ELK\footnote{Elasticsearch Logstash Kibana}.



\subsection{Limites}
Pour des raisons de disponibilité matériel mais, aussi, d'intérêt par rapport au sujet,
je n'ai pas travaillé sur les clusters Elasticsearch de façon pratique. Elasticsearch
est un logiciel hautement parallélisable, et qui donc scale très bien à l'horizontal. 

Ce rapport se concentre sur l'aspect gestion de logs, il est possible de faire bien
plus avec Elasticsearch que ce qui est présenté dans ce rapport.
De même nous nous concentrons avec logstash sur l'exploitation de syslogs. Il est 
capable de faire d'autres choses, notamment, avec les logs apache. On présentera 
tout de même une base solide de ce qui est faisable avec.


\section{Organisation du rapport}
La première partie du rapport sera consacrée à l'environnement de travail et à la 
présentation des notions. La seconde se concentrera sur le fonctionnement de chacun 
des logiciels utilisés ainsi que quelques problèmes liés à leur exploitation en production.
Enfin la troisième partie conclura ce rapport en présentant la solution retenue 
pour la mise en production, les éventuels ajouts possibles.

\chapter{Environnement}
J'ai réalisé mon stage de Licence professionnelle ASRALL, dans l'équipe réseau Lothaire.
Cette équipe dépend de la Sous Direction des Infrastructures, membre de la Direction 
du numérique de l'Université de Lorraine. Son rôle est d'opérer le réseau des 
établissements scolaires et de recherche de la région Lorraine.
\section{Réseau Lothaire}
\begin{figure}[H]
\center
\includegraphics{lothaire.jpg}
\end{figure}
Le réseau de télécommunications à haut débit sur le territoire de la région Lorraine, 
dénommé Lothaire, est réservé aux secteurs de l’Enseignement Supérieur, de la Recherche 
et du Transfert de Technologie. 

L'équipe Lothaire assure l’interconnexion des réseaux de Nancy (\emph{StanNet}), 
Metz (\emph{AmpereNet}), Epinal (\emph{EpiNet}) ainsi que d'autres sites en région 
(IUFM, CROUS\ldots) avec le réseau \emph{RENATER} (REseau NAtional de télécommunication 
pour la Technologie, l'Enseignement et la Recherche). Ce lien est réalisé au nœud 
régional situé sur le site du Montet (mon lieu de stage) à Vandœuvre-lès-Nancy.

(cf \hyperref[fig:imagereseaulothaire1]{schéma 10.1}  et \hyperref[fig:imagereseaulothaire1]{schéma 10.2} 
en annexes)

\subsection{Historique et rôle et organigrame}

Avant la création de \emph{l'Université de Lorraine} au 1er Janvier 2012 l'équipe 
réseau Lothaire était attachée au CIRIL (Centre Interuniversitaire de Ressources Informatiques
de Lorraine). Depuis, l'organisme a été absorbé par la sous direction des infrastructure
de l'université.

En plus d’opérer les infrastructures du réseau Régional, l’ Equipe Réseau Lothaire 
assure un ensemble de services auprès de la Communauté de l’Enseignement Supérieur 
et de la Recherche de Lorraine :

\begin{itemize}
    \item interface technique et financière avec les établissements partenaires, 
    les opérateurs et les prestataires retenus,
    \item configuration du routage (IPv4 et IPv6) et des règles de sécurité (ACL , 
    Firewall),
    \item service de gestion des noms de domaines (DNS),
    \item développement, maintenance et diffusion nationale d’outils de métrologie ,
    \item administration d’un portail captif (YaCaP) pour les accès Wifi,
    \item filtrage des accès WEB sur certains réseaux,
    \item gestion d’une plateforme pour les accès sécurisés (VPN),
    \item collecte et archivage des traces (logs) des activités réseaux,
    \item mise à disposition de logiciels libres pour la communauté (FTP),
    \item service de synchronisation d’horloge (NTP),
    \item routage d’appel de visioconférences (gatekeeper H323),
    \item gestion des réseaux de campus de l’Université de Lorraine.
\end{itemize}                                                

L'équipe est constituée de 10 ingénieurs, dont 1 responsable Alexandre Simon, ainsi
que d'un enseignant chercheur détaché.


\section{Environnement de travail}
J'ai physiquement réalisé mon stage dans un bureau (plutôt spacieux), en compagnie
d'un autre stagiaire.
Ma machine travail était un ordinateur fixe Dell Optiplex 780 équipé d'un Core2 et 
de 4 Go de RAM. Il m'a été laissé une grande liberté quant à l'installation de mon
système d'exploitation, j'ai donc choisi un classique Debain GNU/Linux.

Cette machine était bien pratique pour réaliser des tests (machines virtuelles, 
installation de logiciels\ldots), mais n'était évidemment pas capable d'ingurgiter 
tous les logs réseau des établissements d'enseignement en Lorraine. On a donc mis 
à ma disposition (dans le Datacenter du bâtiment) 2 serveurs qui serviront après 
la fin du stage de machines de production. Un Dell R520 (12 cœurs, 12Go de RAM),
c'est la machine qui fera tourné Elasticsearch et un Dell 2950 (4 coeurs 4 Go de RAM)
c'est la machine qui accueillera le Logstash qui traitera tous les logs.

Par cohérence avec le reste de l'infrastructure il a été décidé d'installer une 
Debian Jessie, nouvellement stable au moment de l'installation.
%\chapter{La gestion de logs}
%
%La gestion des \gls{logs} est un problème presque aussi vieux que l'informatique.
%Au commencement 
%
%La tendance est cependant (et depuis longtemps) à la centralisation de ces fichiers afin de faciliter 
%leur accès et leur analyse ultérieur. Cela permet également une sauvegarde plus facile de ces derniers 
%dans le cas où cela est nécessaire. Il est fréquent d'avoir des scripts analysant 
%quotidiennement ces \gls{logs} afin de pouvoir détécter un comportement suspect.
%
%
%\chapter{Gestion de projet}
%%\input{tableaudebord.tex}
%\chapter{Présentation des notions}
%\chapter{Définitions}

\part{Les logiciels}
\chapter{Logstash}
\input{logstash.tex}

\chapter{Elasticsearch}
\input{elasticsearch.tex}

\chapter{Kibana}
\input{kibana.tex}

\part{Synthèse et conclusion}
\chapter{Fonctionnement général}

\chapter{Évolutions possible}
\section{Monitoring}
\section{Sécurité}

\chapter{Conclusion}

\part{Annexes}
\chapter{Sources/Webographie/Bibliographie}
\input{sources.tex}
\chapter{Images}
\input{images.tex}
\chapter{Code Source et scripts}
\input{scripts.tex}



\printglossaries

\end{document}
